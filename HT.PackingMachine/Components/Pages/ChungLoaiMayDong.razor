@page "/ChungLoaiMayDong"

@* @attribute [Authorize(Roles = "DeliveryServices.Admin,DeliveryServices.Delivery,DeliveryServices.Packing")] *@

@inject IJSRuntime JSRuntime
@inject IAuthService AuthService

@using HT.PackingMachine.Data.Entities
@using HoangThach.AccountShared.Services
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
<PageTitle>Chủng loại cho máy đóng</PageTitle>


@if (IsAuthen)
{
    <MudStack>
        <EditForm Model="@Input" Context="ct" OnValidSubmit="OnValidSubmit" onkeydown="return event.key != 'Enter'">
            <DataAnnotationsValidator />
            <MudCard Elevation="4">
                <MudCardHeader>
                    <MudText Typo="Typo.h4" Class="pt-3" Align="Align.Left">
                        Chủng loại cho máy đóng
                    </MudText>

                </MudCardHeader>
                <MudDivider DividerType="DividerType.Middle" Class="my-1" />
                <MudCardContent>

                    <MudGrid>
                        <MudItem xs="12" sm="4" md="3">
                            <MudSelect @bind-Value="Input.PackingMachine_Id" Disabled="DisabledSoLo" ErrorId="0" RequiredError="Bạn chưa chọn máy đóng" Required="true" AnchorOrigin="Origin.BottomCenter" Label="Máy đóng" HelperText="Danh sách" Placeholder="Lựa chọn" AdornmentIcon="@Icons.Material.Filled.Api" AdornmentColor="Color.Primary">
                                <MudSelectItem T="int" Value="0">-- Chọn máy đóng --</MudSelectItem>
                                @foreach (var item in packingMachines)
                                {
                                    <MudSelectItem T="int" Value="@item.Id">@item.Name</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>

                        <MudItem xs="12" sm="4" md="3">
                            <MudSelect @bind-Value="Input.Category_Id" ErrorId="0" RequiredError="Bạn chưa chọn chủng loại" Required="true" AnchorOrigin="Origin.BottomCenter" Label="Chủng loại" HelperText="Danh sách" Placeholder="Lựa chọn" AdornmentIcon="@Icons.Material.Filled.Api" AdornmentColor="Color.Primary">
                                <MudSelectItem T="int" Value="0">-- Chọn chủng loại --</MudSelectItem>
                                @foreach (var item in Categories)
                                {
                                    <MudSelectItem T="int" Value="@item.Id">@item.Descr</MudSelectItem>
                                }
                            </MudSelect>
                        </MudItem>


                    </MudGrid>

                </MudCardContent>
                <MudDivider DividerType="DividerType.Middle" Class="my-1" />

                <MudCardActions Class="d-flex justify-end flex-grow-1 gap-4">
                    <MudButton StartIcon="@Icons.Material.Filled.ArrowBack" Color="Color.Tertiary" Class="@ShowEdit" OnClick="Back" Variant="Variant.Filled">Back</MudButton>
                    <MudButton StartIcon="@Icons.Material.Filled.Update" Color="Color.Info" Class="@ShowEdit" OnClick="Update" Variant="Variant.Filled">Lưu</MudButton>
                    <MudButton StartIcon="@Icons.Material.Filled.Delete" Color="Color.Warning" Class="@ShowDelete" OnClick="Delete" Variant="Variant.Filled">Hủy</MudButton>
                    <MudButton StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary" Class="@ShowCreate" ButtonType="ButtonType.Submit" Variant="Variant.Filled">Thêm</MudButton>
                </MudCardActions>
            </MudCard>
        </EditForm>
        <MudTable class="mud-data-grid" Elevation="4" Bordered="false" Height="400px" FixedHeader="true" Breakpoint="Breakpoint.Sm" SortLabel="Lọc theo"
                  Dense="true" Hover="true" Striped="false" HorizontalScrollbar="true" FooterClass="table-foot-bordered" CustomFooter="true"
                  Items="@packingMachineCategoryHistories" Context="ctUser" @bind-SelectedItem="Input" Filter="new Func<PackingMachineCategoryHistory,bool>(FilterFunc)" OnRowClick="RowClickEvent"
                  Loading="@ShowProgress" LoadingProgressColor="Color.Info" T="PackingMachineCategoryHistory">
            <ToolBarContent>
                <MudText Typo="Typo.h4" Class="pt-3" Align="Align.Left">Danh sách Chủng loại cho máy đóng</MudText>

                <MudSpacer></MudSpacer>
                <MudTextField @bind-Value="searchString" Immediate="true" Placeholder="Tìm kiếm chủng loại cho máy đóng" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" AdornmentColor="@Color.Primary" IconSize="Size.Medium" Class="mt-0"></MudTextField>


            </ToolBarContent>
            <HeaderContent>
                <MudTh>
                    #
                </MudTh>
                <MudTh>Ngày cập nhật</MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<PackingMachineCategoryHistory, object>(x => x.PackingMachine!.Name)">Máy đóng</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<PackingMachineCategoryHistory, object>(x => x.PackingMachine!.Descr)">Chủng loại</MudTableSortLabel></MudTh>
                <MudTh>Từ thời điểm</MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<PackingMachineCategoryHistory, object>(x => x.EndDate)">Đến thời điểm</MudTableSortLabel></MudTh>
                @* <MudTh></MudTh> *@
            </HeaderContent>
            <RowTemplate>
                @{
                    var rn = 0;
                    for (int i = 0; i < packingMachineCategoryHistories.Count(); i++)
                    {
                        rn = packingMachineCategoryHistories.IndexOf(ctUser) + 1;
                    }
                }
                <MudTd DataLabel="#">@rn</MudTd>

                <MudTd DataLabel="Date">@ctUser.ModifiedDate</MudTd>
                <MudTd DataLabel="Name">@ctUser.PackingMachine!.Name</MudTd>
                <MudTd DataLabel="Descr">@ctUser.Category!.Descr</MudTd>
                <MudTd>@ctUser.BeginDate</MudTd>
                <MudTd>@ctUser.EndDate</MudTd>
                @*    <MudTd DataLabel="Chọn">
                    <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" Class="pa-0" OnClick="@(() => SelectPackingMachineCategory(ctUser.Id))" />
                </MudTd> *@
            </RowTemplate>

            <PagerContent>

                <MudTablePager />
            </PagerContent>

        </MudTable>
    </MudStack>
}


