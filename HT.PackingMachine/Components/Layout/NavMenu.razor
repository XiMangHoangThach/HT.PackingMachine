@using HoangThach.AccountShared.Models.Entities
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims

@if (IsDebug)
{
    <MudNavMenu>


        @if (render)
        {
            <MudNavLink Href="https://devaccount.hoangthach.vn" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
            <MudNavLink Href="/" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.Person">Số lô vỏ bao</MudNavLink>
            <MudNavLink Href="SoLoChatLuong" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.DatasetLinked">Số lô chất lượng</MudNavLink>
            <MudNavLink Href="ChungLoaiMayDong" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.GroupWork">Chủng loại máy đóng</MudNavLink>

            <MudNavLink Href="SoLoMayDong" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.Insights">Số lô máy đóng</MudNavLink>


        }

    </MudNavMenu>
}
else
{
    <MudNavMenu>


        @if (render)
        {
            <MudNavLink Href="https://account.hoangthach.vn" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>


            <AuthorizeView Roles="ORG.Admin">
                <Authorized>


                    <MudNavLink Href="/" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.Person">Số lô vỏ bao</MudNavLink>
                    <MudNavLink Href="SoLoChatLuong" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.DatasetLinked">Số lô chất lượng</MudNavLink>
                    <MudNavLink Href="ChungLoaiMayDong" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.GroupWork">Chủng loại máy đóng</MudNavLink>

                    <MudNavLink Href="SoLoMayDong" Match="NavLinkMatch.All" IconColor="@Color.Primary" Icon="@Icons.Material.Filled.Insights">Số lô máy đóng</MudNavLink>



                </Authorized>
            </AuthorizeView>

        }

    </MudNavMenu>
}

@code {

    private bool IsDebug { get; set; }
    bool render = false;
    public string UserId = "";
    [CascadingParameter]
    private Task<AuthenticationState>? AuthenticationState { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            render = true;


            var authState = await AuthenticationState;
            var user = authState.User;

            if (user.Identity is not null && user.Identity.IsAuthenticated)
            {

                var claims = user.Claims;

                UserId = user!.Claims.First().Value;
            }
            StateHasChanged();
        }
    }

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

#if DEBUG
    IsDebug = true;
#else
        IsDebug = false;
#endif
    }

}
